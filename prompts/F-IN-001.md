prompts/F-IN-001.md
Title

Finance v0 — CSV ingest → canonical ledger → PDF reconciliation → cash-flow

Mode

DEV-FAST (local only). No force push. Raw statements stay out of git.

Guardrails

Read only:

data/financial/raw/accountActivityExport.csv

data/financial/raw/**/*.pdf (optional; if present)

Write (safe to commit):

data/financial/working/transactions.csv

data/financial/working/recon_pdf_vs_csv.csv

output/FINANCE_RUN.md

output/FINANCE_CASHFLOW.md

output/FINANCE_CASHFLOW.html

Ensure .gitignore keeps data/financial/raw/** ignored.

Tasks

CSV normalizer

Add scripts/finance_csv_normalize.py to parse accountActivityExport.csv.

Tolerant header mapping (Date/Transaction Date; Description/Details; Amount or Debit/Credit).

Date via dateutil.parser.

Signed amount: prefer Amount; else Credit(+), Debit(–).

Map to canonical fields:

date, description, type, amount, debit, credit,
check_no, counterparty, category, account_last4,
source="csv", source_pdf=null, source_row=<line#>


Type mapping: CHECK→check, ACH CREDIT/DEPOSIT→ach_in|deposit, ACH DEBIT/WITHDRAWAL/PAYMENT→ach_out, POS/CARD→card, FEE→fee, INTEREST→interest, else other.

Output temp data/financial/working/transactions.csv.tmp_csv.

(Optional) PDF rows

If existing PDF-normalized temp exists (transactions.csv.tmp_pdf), keep; else skip.

Merge + reconcile

Add scripts/finance_build_ledger.py:

Load temp CSV + optional PDF rows.

De-dupe across sources with key:
(date, round(amount,2), normalized(description), check_no|'', counterparty|'').

Write merged canonical: data/financial/working/transactions.csv.

Write data/financial/working/recon_pdf_vs_csv.csv with columns:
key, in_pdf, in_csv, amount_pdf, amount_csv, delta, description_sample.

Cash-flow summaries

Add scripts/finance_cashflow.py:

Read canonical ledger.

Compute: YTD inflow/outflow/net, monthly inflow/outflow/net, top 10 outflow counterparties.

Emit:

output/FINANCE_RUN.md (row counts, dedup count, recon stats).

output/FINANCE_CASHFLOW.md (tables).

output/FINANCE_CASHFLOW.html (simple HTML table; no external libs).

Runner

Add scripts/finance_run.ps1 to orchestrate:

python scripts/finance_csv_normalize.py `
  --input data/financial/raw/accountActivityExport.csv `
  --out data/financial/working/transactions.csv.tmp_csv

python scripts/finance_build_ledger.py `
  --csv data/financial/working/transactions.csv.tmp_csv `
  --pdf data/financial/working/transactions.csv.tmp_pdf `
  --out data/financial/working/transactions.csv `
  --recon data/financial/working/recon_pdf_vs_csv.csv

python scripts/finance_cashflow.py


Deps & ignore

Ensure requirements.txt has python-dateutil (add if missing).

Confirm .gitignore keeps data/financial/raw/** ignored but allows data/financial/working/**.

Commit
git add requirements.txt data/.gitignore `
  scripts/finance_csv_normalize.py scripts/finance_build_ledger.py scripts/finance_cashflow.py scripts/finance_run.ps1 `
  data/financial/working/transactions.csv data/financial/working/recon_pdf_vs_csv.csv `
  output/FINANCE_RUN.md output/FINANCE_CASHFLOW.md output/FINANCE_CASHFLOW.html
git commit -m "feat(finance): normalize YTD CSV → canonical ledger; reconcile vs PDF; cash-flow summaries"
git push origin HEAD

Acceptance

data/financial/working/transactions.csv exists and has ≥ the number of CSV rows.

output/FINANCE_CASHFLOW.md shows a monthly table.

data/financial/working/recon_pdf_vs_csv.csv exists (may be empty).

Raw PDFs/CSV remain uncommitted.

Receipts

Append a short human summary to output/FINANCE_RUN.md including:

row counts (csv, pdf, merged), dedup count

months covered

path(s) to cash-flow outputs

Your single action

Tell Cline:

Create prompts/F-IN-001.md with the content I provide, commit, execute scripts/finance_run.ps1, then push.
