prompts/F-IN-002.md
Title

Finance v0.2 — PDF statement ingestion + categorization seed + richer cash-flow

Mode

DEV-FAST (local only). No force push. Keep raw PDFs out of git.

Guardrails

Read (not committed): data/financial/raw/**/*.pdf

Write/commit:

data/financial/working/pdf_rows.csv

data/financial/working/transactions.csv (merged)

data/financial/working/recon_pdf_vs_csv.csv

data/financial/categories.seed.yaml

output/FINANCE_RUN.md (append)

output/FINANCE_CASHFLOW.md, output/FINANCE_CASHFLOW.html (update)

output/FINANCE_QA.md (new: QA notes)

Tasks

PDF → rows (best-effort text parse)

Add scripts/finance_pdf_extract.py:

For each data/financial/raw/**/*.pdf, extract text (use pdfminer.six; if OCR needed later, just note "ocr_needed" in QA).

Parse transactions with tolerant regex:

date: MM/DD/YYYY|MM/DD/YY

amount: supports $, commas, negatives in parens

description: line remainder sans amount/date

Map to temp CSV: data/financial/working/pdf_rows.csv with same canonical columns, source="pdf", source_pdf=<filename>, source_row=<seq>.

Merge + reconcile (update existing builder)

Update scripts/finance_build_ledger.py to:

Load pdf_rows.csv if present.

De-dupe key: (date, round(amount,2), norm(description), check_no or '', counterparty or '').

Write merged data/financial/working/transactions.csv.

Write recon_pdf_vs_csv.csv with flags: only_in_pdf, only_in_csv, both, and delta.

Categories seed (simple rules)

Create data/financial/categories.seed.yaml with examples (extendable):

rules:
  - match: "(?i)home depot|lowe's|gator"
    category: materials
  - match: "(?i)abco|plumb"
    category: plumbing
  - match: "(?i)payroll|adp"
    category: payroll
  - match: "(?i)insurance"
    category: insurance
  - match: "(?i)fuel|gas"
    category: fuel
default_category: other


Add scripts/finance_categorize.py that:

Applies regex rules to description (first match wins).

Fills empty category in transactions.csv and rewrites file in place.

Richer cash-flow

Update scripts/finance_cashflow.py to also produce:

By-category monthly rollup table.

Top 10 vendors (counterparty) YTD.

Embed both tables in FINANCE_CASHFLOW.html.

Runner

Update scripts/finance_run.ps1 to:

python scripts/finance_csv_normalize.py --input data/financial/raw/accountActivityExport.csv --out data/financial/working/transactions.csv.tmp_csv
python scripts/finance_pdf_extract.py --root data/financial/raw --out data/financial/working/pdf_rows.csv
python scripts/finance_build_ledger.py --csv data/financial/working/transactions.csv.tmp_csv --pdf data/financial/working/pdf_rows.csv --out data/financial/working/transactions.csv --recon data/financial/working/recon_pdf_vs_csv.csv
python scripts/finance_categorize.py --rules data/financial/categories.seed.yaml --inout data/financial/working/transactions.csv
python scripts/finance_cashflow.py


Append a brief QA section to output/FINANCE_RUN.md:

counts (csv, pdf, merged), dedup count

of uncategorized rows after rules

any ocr_needed PDFs → also list in output/FINANCE_QA.md

Dependencies

Ensure requirements.txt includes pdfminer.six and python-dateutil. (Add if missing.)

Commit
git add requirements.txt data/.gitignore `
  scripts/finance_pdf_extract.py scripts/finance_categorize.py scripts/finance_build_ledger.py scripts/finance_cashflow.py scripts/finance_run.ps1 `
  data/financial/categories.seed.yaml data/financial/working/pdf_rows.csv data/financial/working/transactions.csv data/financial/working/recon_pdf_vs_csv.csv `
  output/FINANCE_RUN.md output/FINANCE_QA.md output/FINANCE_CASHFLOW.md output/FINANCE_CASHFLOW.html
git commit -m "feat(finance): add PDF ingestion + seed categorization + richer cash-flow; merge & reconcile"
git push origin HEAD

Acceptance

data/financial/working/pdf_rows.csv exists with ≥1 row if PDFs present.

transactions.csv row count ≥ CSV rows (unless dedup reduces).

FINANCE_CASHFLOW.html shows by-month and by-category tables.

FINANCE_QA.md lists any OCR-needed files.
