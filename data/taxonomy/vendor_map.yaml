version: v0
normalizers:
  # simple text filters for vendor lines
  - pattern: "[^a-z0-9\\s]"
    replace: ""
  - pattern: "\\s+"
    replace: " "

rules:
  # map vendor phrase â†’ (trade,item)
  - if: "footing|stem wall|foundation|slab"
    to: { trade: "concrete", item: "foundation" }
  - if: "stud|framing|plate|joist|rafter"
    to: { trade: "framing", item: "framing lumber" }
  - if: "rough plumbing|dwv|pvc|copper"
    to: { trade: "plumbing", item: "rough-in" }
  - if: "electrical rough|outlet|switch|breaker|panel"
    to: { trade: "electrical", item: "rough-in" }
  - if: "shingle|tile roof|underlayment|felt"
    to: { trade: "roofing", item: "roof assembly" }
  - if: "drywall|sheetrock|gypsum"
    to: { trade: "drywall", item: "gypsum board" }
  - if: "tile|thinset|grout"
    to: { trade: "tile", item: "floor tile" }
  - if: "air handler|condenser|duct"
    to: { trade: "hvac", item: "system install" }
  - if: "insulation|batt|blown"
    to: { trade: "insulation", item: "thermal insulation" }
  - if: "paint|primer|finish"
    to: { trade: "paint", item: "interior paint" }

  # F4b Lynn-specific phrases (appended)
  - if: "abco|sprinkler|fire protection|wet system|dry system"
    to: { trade: "fire protection", item: "sprinkler system" }
  - if: "panel|breaker|meter|rough electrical|outlet|switch|lighting"
    to: { trade: "electrical", item: "rough-in" }
  - if: "tile|thinset|grout|schluter|floor tile|wall tile"
    to: { trade: "tile", item: "floor tile" }
  - if: "hvac|air handler|condenser|duct|line set|mini split"
    to: { trade: "hvac", item: "system install" }
  - if: "insulation|batt|blown|spray foam"
    to: { trade: "insulation", item: "thermal insulation" }
  - if: "roof|underlayment|shingle|tile roof|flashing|drip edge"
    to: { trade: "roofing", item: "roof assembly" }
  - if: "plumbing rough|dwv|copper|pvc|pex|fixtures"
    to: { trade: "plumbing", item: "rough-in" }
  - if: "drywall|sheetrock|gypsum|taping|finishing"
    to: { trade: "drywall", item: "gypsum board" }
  - if: "paint|primer|finish|interior paint"
    to: { trade: "paint", item: "interior paint" }
  - if: "foundation|footing|stem wall|slab|concrete"
    to: { trade: "concrete", item: "foundation" }
  - if: "cabinet|millwork|vanity"
    to: { trade: "casework", item: "cabinets" }

  # Align vendor phrases to RAW estimate keys (to enable calibration overlap)
  - if: "(?i)\\bslab(s)?\\b"
    to: { trade: "concrete", item: "slab_area" }
  - if: "(?i)\\bwall(s)?\\b"
    to: { trade: "framing", item: "wall_linear" }

  # Plumbing specific items from RAW estimate
  - if: "(?i)\\b(toilet|wc|water\\s*closet)\\b"
    to: { trade: "plumbing", item: "toilet" }
  - if: "(?i)\\b(lav|lavatory|vanity|sink)\\b"
    to: { trade: "plumbing", item: "lavatory_sink" }
  - if: "(?i)\\bshower\\b"
    to: { trade: "plumbing", item: "shower" }
  - if: "(?i)\\b(tub|bathtub)\\b"
    to: { trade: "plumbing", item: "bathtub" }
  - if: "(?i)\\bhose\\s*bibb\\b"
    to: { trade: "plumbing", item: "hose_bibb" }
  - if: "(?i)\\bfloor\\s*drain\\b"
    to: { trade: "plumbing", item: "floor_drain" }
  - if: "(?i)\\bfixture(s)?\\b"
    to: { trade: "plumbing", item: "fixtures" }

unit_overrides:
  sf: SF
  sy: SY
  lf: LF
  cy: CY
  ea: EA
  ls: LS

parsing:
  max_line_amount: 800000
  drop_total_keywords:
    - subtotal
    - total
    - grand total
    - price
    - description
    - amount due
    - invoice total
  dedupe_window: 250
  drop_line_keywords:
    - tax
    - allowance
    - freight
    - delivery
    - permit
    - bond
    - insurance
    - mobilization
    - supervision
    - alt
    - alternate
    - option
  numeric_only_desc_min_len: 5
  accept_suffixes: ["K","M"]
  prefer_latest_file: true
  acceptable_ratio: 0.3..3.0
